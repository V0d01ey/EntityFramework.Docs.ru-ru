---
title: Типы запросов - EF Core
author: anpete
ms.author: anpete
ms.date: 2/26/2018
ms.assetid: 9F4450C5-1A3F-4BB6-AC19-9FAC64292AAD
ms.technology: entity-framework-core
uid: core/modeling/query-types
ms.openlocfilehash: f16e3a130f3a4f92b2bf6014f2df0ca4eec56a25
ms.sourcegitcommit: 038acd91ce2f5a28d76dcd2eab72eeba225e366d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/14/2018
---
# <a name="query-types"></a>Типы запросов
> [!NOTE]
> Этот компонент является новые возможности EF Core 2.1

Помимо типов сущностей, могут содержать EF базовой модели _типами запросов_, который может использоваться для выполнения запросов к базе данных с данными, который не сопоставляется с типами сущностей.

Типы запросов имеют много общего с типами сущностей:

- Их можно также добавить в модель либо в `OnModelCreating`, или через свойство «набор» на производный _DbContext_.
- Они поддерживают многие те же возможности сопоставления, как наследование, сопоставление свойств навигации (см. ниже ограничения) и в реляционных хранилищах, возможность настройки целевых объектов базы данных и столбцы через методы fluent API или заметок к данным.

Однако они отличаются от сущности типов в том, что они:

- Ключ определен не требуется.
- Никогда не отслеживаются для изменения на _DbContext_ и поэтому не вставлены, обновляются или удаляются в базе данных.
- Никогда не обнаруживаются по соглашению.
- Поддерживают только подмножество возможности навигации сопоставление — в частности:
  - Они никогда не могут работать как основной элемент связи.
  - Они могут содержать только свойствах навигации ссылки, указывающие на сущности.
  - Сущности не может содержать свойства навигации для типов запросов.
- Посвящена _построитель ModelBuilder_ с помощью `Query` метод вместо `Entity` метод.
- Сопоставленные на _DbContext_ по свойствам типа `DbQuery<T>` вместо `DbSet<T>`
- Сопоставляются с объектами базы данных с помощью `ToView` метода, а не `ToTable`.
- Может быть сопоставлен _определение запроса_ — определение запроса — это дополнительный запрос, объявленные в модели, который выступает в источник данных для типа запроса.

Ниже приведены некоторые из сценариев использования основных типов запросов.

- Для нерегламентированных выступают в качестве возвращаемого типа для `FromSql()` запросов.
- Сопоставление для представления базы данных.
- Сопоставление таблиц, у которых нет первичного ключа.
- Сопоставление запросов, определенных в модели.

> [!TIP]
> Сопоставление типа запроса к объекту базы данных достигается с помощью `ToView` fluent API. С точки зрения EF Core, является объект базы данных, указанный в этом методе _представление_, то есть, он рассматривается как исходный запрос только для чтения и не может быть целевым объектом обновления, insert или delete операций. Однако это не означает, что объект базы данных фактически требуется представление базы данных - в качестве альтернативы можно таблицу базы данных, которое будет интерпретироваться как доступный только для чтения. И наоборот, для типов сущностей, EF Core предполагается, что объект базы данных, указанный в `ToTable` метод могут рассматриваться как _таблицы_, это означает, что можно использовать в качестве источника запроса, но также распространяется обновление, удаление и вставка операции. На самом деле, можно указать имя представления базы данных в `ToTable` и все данные должны корректно работать, пока представление настроен в качестве обновляемой базы данных.

## <a name="example"></a>Пример

В следующем примере показано, как используется тип запроса для запроса представления базы данных.

> [!TIP]
> Для этой статьи вы можете скачать [пример](https://github.com/aspnet/EntityFrameworkCore/tree/dev/samples/QueryTypes) из репозитория GitHub.

Во-первых определим простой модели блога и Post.

[!code-csharp[Main](../../../efcore-dev/samples/QueryTypes/Program.cs#Entities)]

Затем определяется представление простой базы данных, мы будем запрашивать количество записей, связанных с каждого блога:

[!code-csharp[Main](../../../efcore-dev/samples/QueryTypes/Program.cs#View)]

Затем определяется класс, содержащий результат из представления базы данных:

[!code-csharp[Main](../../../efcore-dev/samples/QueryTypes/Program.cs#QueryType)]

Далее мы настраиваем тип запроса в _OnModelCreating_ с помощью `modelBuilder.Query<T>` API.
Мы используем стандартной конфигурации fluent API-интерфейсы для настройки сопоставления для типа запроса:

[!code-csharp[Main](../../../efcore-dev/samples/QueryTypes/Program.cs#Configuration)]

Наконец можно запросить представления базы данных обычным образом:

[!code-csharp[Main](../../../efcore-dev/samples/QueryTypes/Program.cs#Query)]

> [!TIP]
> Обратите внимание, что мы определили свойство контекста запроса уровня (DbQuery) в качестве корневой для запросов этого типа.

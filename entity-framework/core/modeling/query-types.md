---
title: Типы запросов — EF Core
author: anpete
ms.author: anpete
ms.date: 2/26/2018
ms.assetid: 9F4450C5-1A3F-4BB6-AC19-9FAC64292AAD
ms.technology: entity-framework-core
uid: core/modeling/query-types
ms.openlocfilehash: 5a2cd451da8833daf2c315419559eb4a2c705b13
ms.sourcegitcommit: 4467032fd6ca223e5965b59912d74cf88a1dd77f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/01/2018
ms.locfileid: "39388485"
---
# <a name="query-types"></a>Типы запросов
> [!NOTE]
> Эта функция находится в EF Core 2.1

В дополнение к типам сущностей, могут содержать модель EF Core _типы запросов_, который может использоваться для выполнения запросов к базе данных для данных, которые не сопоставлены с типами сущностей.

Типы запросов имеют много общего с типами сущностей:

- Они также могут добавляться к модели либо в `OnModelCreating`, или с помощью свойства «набор» на производный _DbContext_.
- Они поддерживают многие из те же возможности сопоставления, как наследование, сопоставление свойства навигации (см. в разделе ограничений ниже) и в реляционных хранилищах, возможность настройки целевых объектов базы данных и столбцы с помощью текучего API методы или заметки к данным.

Тем не менее они отличаются от сущностей тем, что в них типы:

- Ключ должен быть определен не требуется.
- Никогда не отслеживаются для изменения на _DbContext_ и поэтому никогда не вставке, удалении или обновлении в базе данных.
- Никогда не обнаруживаются по соглашению.
- Поддерживают только подмножество возможностей навигации сопоставления — в частности:
  - Они никогда не может выступать в качестве основной конец связи.
  - Могут содержать только свойства навигации ссылки на сущности.
  - Сущности не может содержать свойства навигации к типам запросов.
- Посвящена _ModelBuilder_ с помощью `Query` метод вместо `Entity` метод.
- Сопоставляются на _DbContext_ через свойства типа `DbQuery<T>` вместо `DbSet<T>`
- Сопоставляются с объектами базы данных с помощью `ToView` метод, а не `ToTable`.
- Могут быть сопоставлены с _запроса_ — определение запроса — это дополнительный запрос, объявленные в модели, используемый источник данных для типа запроса.

Ниже приведены некоторые из основных варианта применения типы запросов.

- Выступая в качестве возвращаемого типа для нерегламентированных `FromSql()` запросов.
- Сопоставление с представлениями базы данных.
- Сопоставление таблиц, у которых не определен первичный ключ.
- Сопоставление с запросами, определенными в модели.

> [!TIP]
> Сопоставление типа запроса к объекту базы данных достигается с помощью `ToView` текучего API. С точки зрения EF Core, является объект базы данных, указанный в этом методе _представление_, это означает, что она обрабатывается как источник запроса только для чтения и не может быть целевым объектом update, insert или delete операций. Тем не менее это не означает, что объект базы данных требуется фактически быть представления базы данных - также может быть таблицей базы данных, которое будет интерпретироваться как доступный только для чтения. И наоборот, для типов сущностей, EF Core предполагает, что объект базы данных, указанные в `ToTable` метод может рассматриваться как _таблицы_, это означает, что он может использоваться как источник запроса, но также предназначено обновление, удаление и вставка операции. На самом деле, можно указать имя представления базы данных в `ToTable` и все должно работать нормально, пока представление настроено как обновляемые в базе данных.

## <a name="example"></a>Пример

В следующем примере показано, как использовать тип запроса для запроса представления базы данных.

> [!TIP]
> Для этой статьи вы можете скачать [пример](https://github.com/aspnet/EntityFrameworkCore/tree/master/samples/QueryTypes) из репозитория GitHub.

Во-первых определим простую модель блога и Post.

[!code-csharp[Main](../../../efcore-repo/samples/QueryTypes/Program.cs#Entities)]

Далее мы определим представление простой базы данных, которые позволят нам запросить число сообщений, связанных с каждого блога:

[!code-csharp[Main](../../../efcore-repo/samples/QueryTypes/Program.cs#View)]

Далее мы определим класс для хранения результата из представления базы данных:

[!code-csharp[Main](../../../efcore-repo/samples/QueryTypes/Program.cs#QueryType)]

Далее мы настраиваем тип запроса в _OnModelCreating_ с помощью `modelBuilder.Query<T>` API.
Мы используем стандартную конфигурацию fluent API-интерфейсы для настройки сопоставления для типа запроса:

[!code-csharp[Main](../../../efcore-repo/samples/QueryTypes/Program.cs#Configuration)]

Наконец можно запросить представления базы данных обычным образом:

[!code-csharp[Main](../../../efcore-repo/samples/QueryTypes/Program.cs#Query)]

> [!TIP]
> Обратите внимание, что мы определили свойство контекста запроса уровня (DbQuery) в качестве корневого для запросов этого типа.

---
title: Быстрый запуск с помощью NGen - EF6
author: divega
ms.date: 2016-10-23
ms.prod: entity-framework
ms.author: divega
ms.manager: avickers
ms.technology: entity-framework-6
ms.topic: article
ms.assetid: dc6110a0-80a0-4370-8190-cea942841cee
caps.latest.revision: 4
ms.openlocfilehash: cffd2deea3148a16ed704d1e5e7b365eda06f72b
ms.sourcegitcommit: bdd06c9a591ba5e6d6a3ec046c80de98f598f3f3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/10/2018
ms.locfileid: "39122737"
---
# <a name="improving-startup-performance-with-ngen"></a>Быстрый запуск с помощью NGen
> [!NOTE]
> **Только в EF6 и более поздних версиях**. Функции, API и другие возможности, описанные на этой странице, появились в Entity Framework 6. При использовании более ранней версии могут быть неприменимы некоторые или все сведения.  

Платформа .NET Framework поддерживает создание образов в машинном коде для управляемых приложений и библиотек, как способ защиты приложения запускаются быстрее, а также в некоторых случаях использовать меньше памяти. Образы в машинном коде создаются путем перевода сборки с управляемым кодом в файлы, содержащие инструкции машинного перед выполнением приложения, освобождая разработчика компилятор .NET JIT (Just-In-Time) от необходимости создания собственного инструкциям, приведенным в Среда выполнения приложения.  

До версии 6 библиотеки среды выполнения EF core были частью .NET Framework и образы в машинном коде были автоматически созданы для них. Начиная с версии 6 всей среды выполнения EF объединены в пакет EntityFramework NuGet. Образы в машинном коде для теперь быть созданы с помощью средства командной строки NGen.exe для получения результатов похожих.  

Эмпирическим наблюдениям показывают, что образы в машинном коде для сборки среды выполнения EF можно вырезать от 1 до 3 секунд времени запуска приложения.  

## <a name="how-to-use-ngenexe"></a>Как использовать NGen.exe  

Основная функция средством NGen.exe — «установка» (то есть для создания и сохранения на диск) образов в машинном коде для сборки и всех его прямых зависимостей. Вот, как это можно сделать:  

1. Откройте окно командной строки с правами администратора  
2. Измените расположение сборок, которые требуется создать образы в машинном коде для текущего рабочего каталога:  

  ``` console
    cd <*Assemblies location*>  
  ```
3. В зависимости от операционной системы и конфигурации для приложения может потребоваться для создания образов в машинном коде для 32-разрядной архитектуры, 64-разрядной архитектуры или одновременно обеих платформ.  

    Для запуска 32-разрядная версия:  
  ``` console
    %WINDIR%\Microsoft.NET\Framework\v4.0.30319\ngen install <Assembly name>  
  ```
    Для 64-разрядных запуска:
  ``` console
    %WINDIR%\Microsoft.NET\Framework64\v4.0.30319\ngen install <Assembly name>  
  ```

> [!TIP]
> Создание образов в машинном коде для неправильной архитектурой является распространенной ошибкой. Если сомневаетесь, можно просто создать образы в машинном коде для всех архитектур, которые применяются к операционной системы, установленной на компьютере.  

NGen.exe также поддерживает другие функции, такие как удаление и Отображение установленных образов в машинном коде, очереди создания нескольких образов и т. д. Дополнительные сведения об использовании. в статье [документации NGen.exe](https://msdn.microsoft.com/library/6t9t5wcf.aspx).  

## <a name="when-to-use-ngenexe"></a>Когда следует использовать NGen.exe  

Когда дело доходит до решить, какие сборки для создания образов в машинном коде для в приложении, в зависимости от EF 6 или более поздней версии, учитывайте следующие параметры.  

- **Основной сборки среды выполнения EF, EntityFramework.dll**: типичного приложения на основе EF выполняет значительный объем кода из этой сборки, при запуске или при его первом доступе к базе данных. Следовательно создание образов в машинном коде для этой сборки приведет крупнейших выигрыш в производительности при запуске.  
- **Любой сборки поставщика EF, используемой приложением**: время запуска также могут немного выиграть от генерации машинных образов из них. Например если приложение использует поставщика EF для SQL Server требуется создать образ в машинном коде для EntityFramework.SqlServer.dll.  
- **Сборок приложения и другие зависимости**: [документации NGen.exe](https://msdn.microsoft.com/library/6t9t5wcf.aspx) рассматриваются общие критерии для выбора сборки для создания образов в машинном коде и влияние образов в машинном коде на безопасности, Дополнительные параметры, такие как «жесткая привязка», сценарии, как использование образов в машинном коде в отладки и профилирования, сценарии и т. д.  

> [!TIP]
> Убедитесь в том, что вы тщательно оценить влияние использования образов в машинном коде на производительность при запуске и общую производительность приложения и сравните их с фактические требования. Образы в машинном коде обычно помогает повысить запуска показатель производительности и в некоторых случаях снизить использование памяти, столь же отразится не для всех сценариев. К примеру в устойчивом состоянии выполнения (то есть после хотя бы один раз после вызова всех методов, которые используются приложением) код, сгенерированный JIT-компилятор может фактически дать немного лучшую производительность, чем образы в машинном коде.  

## <a name="using-ngenexe-in-a-development-machine"></a>С помощью NGen.exe на машине разработки  

Во время разработки .NET JIT компилятора предложит установить общую наилучшего для кода, который часто изменяется. Создание образов в машинном коде для скомпилированного зависимости, такие как сборки среды выполнения EF может помочь ускорить процесс разработки и тестирования, вырезание несколько секунд в начале каждого выполнения.  

Отлично подходит для поиска сборки среды выполнения EF является расположение пакета NuGet для решения. Например, для приложения с помощью EF 6.0.2 с SQL Server и предназначенных для .NET 4.5 или более поздней можно ввести следующее в окне командной строки (не забудьте открыть его в качестве администратора):  

``` console
cd <Solution directory>\packages\EntityFramework.6.0.2\lib\net45
%WINDIR%\Microsoft.NET\Framework\v4.0.30319\ngen install EntityFramework.SqlServer.dll
%WINDIR%\Microsoft.NET\Framework64\v4.0.30319\ngen install EntityFramework.SqlServer.dll
```  

> [!NOTE]
> Это позволяет пользоваться преимуществами тот факт, что установка образы в машинном коде для поставщика EF для SQL Server также по умолчанию установит образы в машинном коде для основной сборки среды выполнения EF. Это работает, поскольку NGen.exe можно определить, что EntityFramework.dll прямых зависимостей сборки EntityFramework.SqlServer.dll, расположенной в том же каталоге.  

## <a name="creating-native-images-during-setup"></a>Создание образов в машинном коде во время установки  

Набор средств WiX поддерживает очереди создание образов в машинном коде для управляемых сборок во время установки, описанные в этой [практическом руководстве](http://wixtoolset.org/documentation/manual/v3/howtos/files_and_registry/ngen_managed_assemblies.html). Другой вариант — Создать задачу пользовательской установки, воспользуйтесь командой NGen.exe.  

## <a name="verifying-that-native-images-are-being-used-for-ef"></a>Проверка того, что образы в машинном коде используются для Entity FRAMEWORK  

Убедитесь, что определенное приложение использует машинные сборки для загружаемых сборок, которые имеют расширение «. ni.dll «или». ni.exe». Например образ в машинном коде для сборки основной среды выполнения EF будет вызываться EntityFramework.ni.dll. Простой способ проверки загруженных сборок .NET процесса является использование [Process Explorer](https://technet.microsoft.com/sysinternals/bb896653).  

## <a name="other-things-to-be-aware-of"></a>Следует учитывать следующие моменты  

**Создание образа в машинном коде сборки не следует путать с регистрации сборки в [GAC (глобальный кэш сборок)](https://msdn.microsoft.com/library/yf1d93sz.aspx)**. NGen.exe позволяет создавать образы сборок, которые не находятся в глобальном кэше СБОРОК, а на самом деле, несколько приложений, использующих определенную версию EF могут совместно использовать же образа в машинном коде. Хотя Windows 8 может автоматически создавать образы в машинном коде для сборок, помещенных в глобальный кэш СБОРОК, исполняющая среда EF оптимизирован для развертывания вместе с приложения, и мы не рекомендуем его регистрация в глобальном кэше СБОРОК, как это негативно влияет на разрешения сборки и обслуживание приложений среди других аспектах.  

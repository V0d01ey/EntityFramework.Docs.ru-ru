---
title: Конструктора запросов хранимые процедуры — EF6
author: divega
ms.date: 2016-10-23
ms.prod: entity-framework
ms.author: divega
ms.manager: avickers
ms.technology: entity-framework-6
ms.topic: article
ms.assetid: 9554ed25-c5c1-43be-acad-5da37739697f
caps.latest.revision: 3
ms.openlocfilehash: a08c1afc02266b35372a49fca1e829963e4785b2
ms.sourcegitcommit: f05e7b62584cf228f17390bb086a61d505712e1b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/08/2018
ms.locfileid: "39122310"
---
# <a name="designer-query-stored-procedures"></a>Конструктора запроса хранимых процедур
Это пошаговое руководство показано, как используется Entity Framework Designer (конструктор EF) для импорта хранимой процедуры в модели, а затем вызвать импортированных хранимые процедуры для получения результатов. 

Обратите внимание, что Code First не поддерживает сопоставление хранимых процедур или функций. Тем не менее можно вызвать хранимые процедуры или функции с помощью метода System.Data.Entity.DbSet.SqlQuery. Пример:
``` csharp
var query = context.Products.SqlQuery("EXECUTE [dbo].[GetAllProducts]")`;
```

## <a name="prerequisites"></a>Предварительные требования

Для выполнения данного пошагового руководства требуется:

- Последнюю версию Visual Studio.
- [Образца базы данных School](~/ef6/resources/school-database.md).

## <a name="set-up-the-project"></a>Настройка проекта

-   Откройте Visual Studio 2012.
-   Выберите **файл -&gt; Новинка —&gt; проекта**
-   В левой области щелкните **Visual C\#**, а затем выберите **консоли** шаблона.
-   Введите **EFwithSProcsSample** как имя.
-   Нажмите кнопку **ОК**.

## <a name="create-a-model"></a>Создание модели

-   Щелкните правой кнопкой мыши проект в обозревателе решений и выберите **Add -&gt; новый элемент**.
-   Выберите **данных** меню слева, а затем выберите **ADO.NET Entity Data Model** в области шаблонов.
-   Введите **EFwithSProcsModel.edmx** имя файла, а затем нажмите кнопку **добавить**.
-   В диалоговом окне Выбор содержимого модели выберите **создать из базы данных**, а затем нажмите кнопку **Далее**.
-   Нажмите кнопку **новое подключение**.  
    В диалоговом окне Свойства соединения, введите имя сервера (например, **(localdb)\\mssqllocaldb**) выберите метод проверки подлинности, тип **School** для имени базы данных, а затем Нажмите кнопку **ОК**.  
    В диалоговом окне Выбор подключения к базе данных обновляется параметр подключения базы данных.
-   В диалоговом окне Выбор объектов базы данных проверьте **таблиц** флажок, чтобы выбрать все таблицы.  
    Кроме того, выберите следующие хранимые процедуры в разделе **хранимые процедуры и функции** узла: **GetStudentGrades** и **GetDepartmentName**. 

    ![Импорт](~/ef6/media/import.jpg)

    *Начиная с Visual Studio 2012 конструкторе EF поддерживает массовый импорт хранимых процедур. **Импортировать выбранные хранимые процедуры и функции в модели theentity** установлен по умолчанию.*
-   Нажмите кнопку **Готово**.

По умолчанию результирующая форма каждого импортированного хранимую процедуру или функцию, которая возвращает более одного столбца автоматически становится новый сложный тип. В этом примере требуется сопоставить результаты **GetStudentGrades** функцию **StudentGrade** сущности и результаты **GetDepartmentName** для **none** (**none** значение по умолчанию).

Импорт функции для возврата типа сущности столбцы, возвращенные соответствующей хранимой процедуры должно совпадать скалярных свойств типа возвращаемой сущности. Импорт функции также может возвращать коллекции простых типов, сложных типов или нет значения.

-   Щелкните правой кнопкой мыши область конструктора и выберите **браузер моделей**.
-   В **браузер моделей**выберите **импортируемые функции**, а затем дважды щелкните **GetStudentGrades** функции.
-   В диалоговом окне Изменение импорта функции выберите **сущностей** и выберите **StudentGrade**.  
    ***Импорт функции составляема** флажок в верхней части **импортируемые функции** диалогового окна можно сопоставить с поддержкой композиции функции. Если этот флажок установлен, только составную функциях (функции, возвращающие табличные значения) будет отображаться в **хранимой процедуры или имя функции** стрелку раскрывающегося списка. Если вы не установите этот флажок, в списке отобразятся только функции, не допускающие композицию.*

## <a name="use-the-model"></a>Использование модели

Откройте **Program.cs** файл, в котором **Main** определен метод. Добавьте следующий код в функцию Main.

Код вызывает две хранимые процедуры: **GetStudentGrades** (возвращает **StudentGrades** для указанного *StudentId*) и **GetDepartmentName** (Возвращает имя подразделения в выходном параметре).  

``` csharp
    using (SchoolEntities context = new SchoolEntities())
    {
        // Specify the Student ID.
        int studentId = 2;

        // Call GetStudentGrades and iterate through the returned collection.
        foreach (StudentGrade grade in context.GetStudentGrades(studentId))
        {
            Console.WriteLine("StudentID: {0}\tSubject={1}", studentId, grade.Subject);
            Console.WriteLine("Student grade: " + grade.Grade);
        }

        // Call GetDepartmentName.
        // Declare the name variable that will contain the value returned by the output parameter.
        ObjectParameter name = new ObjectParameter("Name", typeof(String));
        context.GetDepartmentName(1, name);
        Console.WriteLine("The department name is {0}", name.Value);

    }
```

Скомпилируйте и запустите приложение. Программа выдает следующие результаты.

```
StudentID: 2
Student grade: 4.00
StudentID: 2
Student grade: 3.50
The department name is Engineering
```

<a name="output-parameters"></a>Выходные параметры
-----------------

Если используются выходные параметры, их значения не будут доступны, пока не полностью считать результаты. Это происходит из-за особенностей DbDataReader, см. в разделе [получение данных с помощью объекта DataReader](http://go.microsoft.com/fwlink/?LinkID=398589) для получения дополнительных сведений.

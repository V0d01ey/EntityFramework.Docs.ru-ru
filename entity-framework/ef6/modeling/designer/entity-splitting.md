---
title: Разделение конструктора сущностей - EF6
author: divega
ms.date: 2016-10-23
ms.prod: entity-framework
ms.author: divega
ms.manager: avickers
ms.technology: entity-framework-6
ms.topic: article
ms.assetid: aa2dd48a-1f0e-49dd-863d-d6b4f5834832
caps.latest.revision: 3
ms.openlocfilehash: 386b739363fb78641d5ebd8130fd19008bc8c9f6
ms.sourcegitcommit: f05e7b62584cf228f17390bb086a61d505712e1b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/08/2018
ms.locfileid: "39122265"
---
# <a name="designer-entity-splitting"></a>Разбиение конструктора сущностей
В этом пошаговом руководстве показано, как сопоставить тип сущности с двумя таблицами путем изменения модели с Entity Framework Designer (конструктор EF). Сущность можно сопоставить с несколькими таблицами, если в таблицах имеется общий ключ. Основные понятия, которые применяются для сопоставления типа сущности с двумя таблицами, легко распространить на сопоставление типа сущности более чем с двумя таблицами.

На следующем рисунке показана основные окна, которые используются при работе с конструктором EF.

![EFDesigner](~/ef6/media/efdesigner.png)

## <a name="prerequisites"></a>Предварительные требования

Visual Studio 2012 или Visual Studio 2010 Ultimate, Premium, Professional и Web Express edition.

## <a name="create-the-database"></a>Создание базы данных

Сервер базы данных, который устанавливается вместе с Visual Studio отличается в зависимости от версии Visual Studio, вы установили:

-   Если вы используете Visual Studio 2012, а затем вы создадите базу данных LocalDB.
-   Если вы используете Visual Studio 2010 вы создадите базу данных SQL Express.

Сначала мы создадим базу данных с двумя таблицами, которые мы хотим объединить в одну сущность.

-   Открытие Visual Studio
-   **Представление —&gt; обозревателя серверов**
-   Щелкните правой кнопкой мыши **подключения к данным -&gt; добавить соединение...**
-   Если вы не подключились к базе данных с помощью обозревателя сервера прежде, чем вам нужно будет выбрать **Microsoft SQL Server** как источник данных
-   Подключение к LocalDB или SQL Express, в зависимости от того, какой из них установки
-   Введите **EntitySplitting** имя базы данных
-   Выберите **ОК** и вам нужно будет Если вы хотите создать новую базу данных, выберите **Да**
-   Новая база данных появится в обозревателе серверов
-   Если вы используете Visual Studio 2012
    -   Щелкните правой кнопкой мыши, в базе данных в обозревателе серверов и выберите **новый запрос**
    -   Скопируйте следующий запрос SQL в новый запрос, а затем щелкните правой кнопкой мыши запрос и выберите **Execute**
-   Если вы используете Visual Studio 2010
    -   Выберите **тарифный план —&gt; Transact редактор SQL -&gt; новое соединение запроса...**
    -   Введите **.\\ SQLEXPRESS** имя сервера и нажмите кнопку **ОК**
    -   Выберите **EntitySplitting** базы данных в раскрывающемся вниз в верхней части редактора запросов
    -   Скопируйте следующий запрос SQL в новый запрос, а затем щелкните правой кнопкой мыши запрос и выберите **Выполнение SQL**

``` SQL
CREATE TABLE [dbo].[Person] (
[PersonId] INT IDENTITY (1, 1) NOT NULL,
[FirstName] NVARCHAR (200) NULL,
[LastName] NVARCHAR (200) NULL,
CONSTRAINT [PK_Person] PRIMARY KEY CLUSTERED ([PersonId] ASC)
);

CREATE TABLE [dbo].[PersonInfo] (
[PersonId] INT NOT NULL,
[Email] NVARCHAR (200) NULL,
[Phone] NVARCHAR (50) NULL,
CONSTRAINT [PK_PersonInfo] PRIMARY KEY CLUSTERED ([PersonId] ASC),
CONSTRAINT [FK_Person_PersonInfo] FOREIGN KEY ([PersonId]) REFERENCES [dbo].[Person] ([PersonId]) ON DELETE CASCADE
);
```

## <a name="create-the-project"></a>Создание проекта

-   В меню **Файл** выберите пункт **Создать**, а затем команду **Проект**.
-   В левой области щелкните **Visual C\#**, а затем выберите **консольное приложение** шаблона.
-   Введите **MapEntityToTablesSample** как имя проекта и нажмите кнопку **ОК**.
-   Нажмите кнопку **нет** Если будет предложено сохранить запрос SQL, созданный в первом разделе.

## <a name="create-a-model-based-on-the-database"></a>Создать модель на основе базы данных

-   Щелкните правой кнопкой мыши имя проекта в обозревателе решений, выберите пункт **добавить**, а затем нажмите кнопку **новый элемент**.
-   Выберите **данных** меню слева, а затем выберите **ADO.NET Entity Data Model** в области шаблонов.
-   Введите **MapEntityToTablesModel.edmx** имя файла, а затем нажмите кнопку **добавить**.
-   В диалоговом окне Выбор содержимого модели выберите **создать из базы данных**, а затем нажмите кнопку **Далее.**
-   Выберите **EntitySplitting** подключения из раскрывающегося списка и нажмите кнопку **Далее**.
-   В диалоговом окне Выбор объектов базы данных, установите флажок рядом с полем **таблиц** узла.
    Это добавит все таблицы из **EntitySplitting** базы данных в модель.
-   Нажмите кнопку **Готово**.

Конструктор сущностей, который предоставляет область конструктора для изменения модели, отображается.

## <a name="map-an-entity-to-two-tables"></a>Сопоставить сущности с двумя таблицами

На этом шаге мы обновим **Person** тип сущности для объединения данных из **Person** и **PersonInfo** таблиц.

-   Выберите **электронной почты** и **Phone** свойства ** PersonInfo ** сущности и нажмите клавишу **Ctrl + X** ключи.
-   Выберите ** Person ** сущности и нажмите клавишу **Ctrl + V** ключи.
-   В рабочей области конструирования выберите **PersonInfo** сущности и нажмите клавишу **удалить** кнопку на клавиатуре.
-   Нажмите кнопку **нет** при запросе, если вы хотите удалить **PersonInfo** таблицы из модели, мы сейчас будет сопоставить с **Person** сущности.

    ![DeleteTables](~/ef6/media/deletetables.png)

Для следующего шага требуется **сведения о сопоставлении** окна. Если это окно не отображается, щелкните правой кнопкой мыши область конструктора и выберите **сведения о сопоставлении**.

-   Выберите **Person** типа сущности и нажмите кнопку **&lt;добавить таблицу или представление&gt;** в **сведения о сопоставлении** окна.
-   Выберите ** PersonInfo ** из раскрывающегося списка.
    **Сведения о сопоставлении** окно обновляется с помощью сопоставления столбцов по умолчанию, но это нормально для нашего сценария.

**Person** типа сущности теперь сопоставлена с **Person** и **PersonInfo** таблиц.

![Mapping2](~/ef6/media/mapping2.png)

## <a name="use-the-model"></a>Использование модели

-   Вставьте следующий код в методе Main.

``` csharp
    using (var context = new EntitySplittingEntities())
    {
        var person = new Person
        {
            FirstName = "John",
            LastName = "Doe",
            Email = "john@example.com",
            Phone = "555-555-5555"
        };

        context.People.Add(person);
        context.SaveChanges();

        foreach (var item in context.People)
        {
            Console.WriteLine(item.FirstName);
        }
    }
```

-   Скомпилируйте и запустите приложение.

Следующие инструкции T-SQL были выполнены в базе данных в результате выполнения этого приложения. 

-   Следующие два **вставить** инструкции были выполнены в результате выполнения контекста. SaveChanges(). Они принимают данные из **Person** сущности и разделения между **Person** и **PersonInfo** таблиц.

    ![Insert1](~/ef6/media/insert1.png)

    ![Insert2](~/ef6/media/insert2.png)
-   Следующие **ВЫБЕРИТЕ** был выполнен в результате перечисление людей в базе данных. Он объединяет данные из **Person** и **PersonInfo** таблицы.

    ![Выбрать](~/ef6/media/select.png)

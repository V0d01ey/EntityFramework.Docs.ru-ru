---
title: Model First - EF6
author: divega
ms.date: 2016-10-23
ms.assetid: e1b9c319-bb8a-4417-ac94-7890f257e7f6
ms.openlocfilehash: 3dd0eba29619f09995d7009dd29462c14bde98c4
ms.sourcegitcommit: 0d36e8ff0892b7f034b765b15e041f375f88579a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/09/2018
ms.locfileid: "44251145"
---
# <a name="model-first"></a>Model First
В этом пошаговом руководстве видео и пошаговые познакомят вас с первой модели разработки, использующий Entity Framework. Во-первых, модель позволяет создать новую модель с помощью Entity Framework Designer, а затем создать схему базы данных из модели. Модель хранится в EDMX-файла (расширение EDMX) и их можно просмотреть и изменить в конструкторе Entity Framework. Классы, которые взаимодействуют с в приложении автоматически создаются из файла EDMX.

## <a name="watch-the-video"></a>Просмотреть видео
В этом пошаговом руководстве видео и пошаговые познакомят вас с первой модели разработки, использующий Entity Framework. Во-первых, модель позволяет создать новую модель с помощью Entity Framework Designer, а затем создать схему базы данных из модели. Модель хранится в EDMX-файла (расширение EDMX) и их можно просмотреть и изменить в конструкторе Entity Framework. Классы, которые взаимодействуют с в приложении автоматически создаются из файла EDMX.

**Представляет**: [Роуэн Миллер (Rowan Miller)](http://romiller.com/)

**Видео**: [WMV](http://download.microsoft.com/download/5/B/1/5B1C338C-AFA7-4F68-B304-48BB008146EF/HDI-ITPro-MSDN-winvideo-modelfirst.wmv) | [MP4](http://download.microsoft.com/download/5/B/1/5B1C338C-AFA7-4F68-B304-48BB008146EF/HDI-ITPro-MSDN-mp4video-modelfirst.m4v) | [WMV (ZIP)](http://download.microsoft.com/download/5/B/1/5B1C338C-AFA7-4F68-B304-48BB008146EF/HDI-ITPro-MSDN-winvideo-modelfirst.zip)

## <a name="pre-requisites"></a>Предварительные требования

Для выполнения этого пошагового руководства вам потребуется Visual Studio 2010 или Visual Studio 2012.

Если вы используете Visual Studio 2010, также необходимо будет иметь [NuGet](http://visualstudiogallery.msdn.microsoft.com/27077b70-9dad-4c64-adcf-c7cf6bc9970c) установлен.

## <a name="1-create-the-application"></a>1. Создание приложения

Для простоты мы создадим простое консольное приложение, использующего Model First для осуществления доступа к данным:

-   Открытие Visual Studio
-   **Файл —&gt; Новинка —&gt; проекта...**
-   Выберите **Windows** в меню слева и **консольного приложения**
-   Введите **ModelFirstSample** как имя
-   Нажмите кнопку **ОК**

## <a name="2-create-model"></a>2. Создание модели

Мы собираемся использовать Entity Framework Designer, который входит в состав Visual Studio, для создания нашей модели.

-   **Проект -&gt; добавить новый элемент...**
-   Выберите **данных** в меню слева и затем **модель EDM ADO.NET**
-   Введите **BloggingModel** имя и нажмите кнопку **ОК**, запустится мастер моделей EDM
-   Выберите **пустую модель** и нажмите кнопку **Готово**

    ![Создание пустой модели](~/ef6/media/createemptymodel.png)

Entity Framework Designer открывается с пустой модели. Теперь мы сможем добавлять сущности, свойства и ассоциации в модели.

-   Щелкните правой кнопкой мыши на область конструктора и выберите **свойства**
-   В окне изменения свойства **имени контейнера сущностей** для **BloggingContext**
    *имя производного контекста, который будет создан автоматически, контекст Представляет сеанс с базой данных, позволяет запрашивать и сохранять данные*
-   Щелкните правой кнопкой мыши на область конструктора и выберите **Add New -&gt; сущности...**
-   Введите **блог** как имя сущности и **BlogId** имя ключа и нажмите кнопку **ОК**

    ![Добавление сущности Blog](~/ef6/media/addblogentity.png)

-   Щелкните правой кнопкой мыши на новую сущность в область конструктора и выберите **Add New -&gt; скалярное свойство**, введите **имя** как имя свойства.
-   Повторите эту процедуру, чтобы добавить **URL-адрес** свойство.
-   Щелкните правой кнопкой мыши **URL-адрес** свойство в область конструктора и выберите **свойства**, в окне изменения свойства **Nullable** присвоить **True** 
     *Это позволяет сохранить блог в базе данных, не назначая его URL-адрес*
-   С помощью методик, вы только что ознакомились предварительными сведениями, добавьте **Post** сущность с **PostId** ключевое свойство
-   Добавить **Title** и **содержимого** скалярные свойства **Post** сущности

Теперь, когда у нас есть несколько сущностей, пришло время добавить сопоставление (или связь) между ними.

-   Щелкните правой кнопкой мыши на область конструктора и выберите **Add New -&gt; связи...**
-   Сделать один конец связи пункты **блог** с кратность **один** и других конечную точку для **Post** с кратность **многих** 
     *Это означает, что блог записях и Post принадлежит один блог*
-   Убедитесь, **добавить свойства внешнего ключа для сущности «Post»** установлен флажок и нажмите кнопку **ОК**

    ![Добавление сопоставления MF](~/ef6/media/addassociationmf.png)

Теперь у нас есть простой модели, которую можно создать базу данных из и использовать для чтения и записи данных.

![Начальная модель](~/ef6/media/modelinitial.png)

### <a name="additional-steps-in-visual-studio-2010"></a>Дополнительные действия в Visual Studio 2010

Если вы работаете в Visual Studio 2010, существуют некоторые дополнительные действия, которые необходимо выполнить для обновления до последней версии платформы Entity Framework. Обновление важно, так как он предоставляет вам доступ к Улучшенная поверхность API, то есть гораздо проще в использовании, а также последние исправления ошибок.

Во-первых, нам нужно получить последнюю версию Entity Framework из NuGet.

-   **Проект —&gt; управление пакетами NuGet... ** 
     *При отсутствии **управление пакетами NuGet... ** следует установить параметр [последнюю версию NuGet](http://visualstudiogallery.msdn.microsoft.com/27077b70-9dad-4c64-adcf-c7cf6bc9970c)*
-   Выберите **Online** вкладку
-   Выберите **EntityFramework** пакета
-   Нажмите кнопку **установки**

Далее нам нужно переключить нашей модели, для которого создается код, который использует API DbContext, который появился в более поздних версиях Entity Framework.

-   Щелкните правой кнопкой мыши пустое место модели в конструкторе EF и выберите **добавить элемент формирования кода...**
-   Выберите **шаблоны в Интернете** из меню слева и выполните поиск **DbContext**
-   Выберите EF **5.x генератор DbContext для C\#**, введите **BloggingModel** имя и нажмите кнопку **добавить**

    ![Шаблон DbContext](~/ef6/media/dbcontexttemplate.png)

## <a name="3-generating-the-database"></a>3. Создание базы данных

Учитывая нашу модель, Entity Framework можно вычислить схему базы данных, которые позволят нам для хранения и извлечения данных с помощью модели.

Сервер базы данных, который устанавливается вместе с Visual Studio отличается в зависимости от версии Visual Studio, вы установили:

-   Если вы используете Visual Studio 2010 вы создадите базу данных SQL Express.
-   Если вы используете Visual Studio 2012, а затем вы создадите [LocalDB](https://msdn.microsoft.com/library/hh510202(v=sql.110).aspx) базы данных.

Перейдем дальше и создать базу данных.

-   Щелкните правой кнопкой мыши на область конструктора и выберите **создать базу данных из модели...**
-   Нажмите кнопку **новое соединение...** и укажите LocalDB или SQL Express, в зависимости от версии Visual Studio вы используете, введите **ModelFirst.Blogging** имя базы данных.

    ![Подключение LocalDB MF](~/ef6/media/localdbconnectionmf.png)

    ![Подключение SQL Express MF](~/ef6/media/sqlexpressconnectionmf.png)

-   Выберите **ОК** и вам нужно будет Если вы хотите создать новую базу данных, выберите **Да**
-   Выберите **Далее** и Entity Framework Designer вычислит скрипт для создания схемы базы данных
-   Если он отображается, нажмите кнопку **Готово** , сценарий будет добавлен в проект и открывается
-   Щелкните правой кнопкой мыши сценарий, а затем выберите **Execute**, вам будет предложено указать базу данных для подключения, укажите LocalDB или SQL Server Express, в зависимости от версии Visual Studio вы используете

## <a name="4-reading--writing-data"></a>4. Чтение и запись данных

Теперь, когда у нас есть модель, настала пора использовать ее для доступа к некоторые данные. Классы мы будем использовать для доступа к данным автоматически создаются зависимости в EDMX-файл.

*Этот снимок экрана из Visual Studio 2012, если вы используете Visual Studio 2010 BloggingModel.tt и BloggingModel.Context.tt файлов будет непосредственно в проекте, а не вложен в узел EDMX-файла.*

![Созданные классы](~/ef6/media/generatedclasses.png)

Реализуйте метод Main в файле Program.cs, как показано ниже. Этот код создает новый экземпляр класса наш контекст, а затем использует его для вставки нового блога. Затем он использует запрос LINQ для извлечения из базы данных, представлены в алфавитном порядке по названию все блоги.

``` csharp
class Program
{
    static void Main(string[] args)
    {
        using (var db = new BloggingContext())
        {
            // Create and save a new Blog
            Console.Write("Enter a name for a new Blog: ");
            var name = Console.ReadLine();

            var blog = new Blog { Name = name };
            db.Blogs.Add(blog);
            db.SaveChanges();

            // Display all Blogs from the database
            var query = from b in db.Blogs
                        orderby b.Name
                        select b;

            Console.WriteLine("All blogs in the database:");
            foreach (var item in query)
            {
                Console.WriteLine(item.Name);
            }

            Console.WriteLine("Press any key to exit...");
            Console.ReadKey();
        }
    }
}
```

Теперь можно запустить приложение и протестировать его.

```
Enter a name for a new Blog: ADO.NET Blog
All blogs in the database:
ADO.NET Blog
Press any key to exit...
```

## <a name="5-dealing-with-model-changes"></a>5. Изменения модели

Теперь пора внести некоторые изменения в нашей модели, когда мы внести эти изменения, необходимо также обновить схему базы данных.

Мы начнем с добавления новой сущности пользователя для нашей модели.

-   Добавьте новый **пользователя** имя сущности с **Username** как имя ключа и **строка** как тип свойства для ключа

    ![Добавление сущности "пользователь"](~/ef6/media/adduserentity.png)

-   Щелкните правой кнопкой мыши **Username** свойство в область конструктора и выберите **свойства**, изменение свойства окна **MaxLength** присвоить значение **50 ** 
     *Это ограничивает данные, которые могут быть сохранены в имени пользователя до 50 символов*
-   Добавить **DisplayName** скалярного свойства к **пользователя** сущности

Теперь у нас есть обновленной модели, и мы готовы обновить базу данных в соответствии с наш новый тип сущности пользователя.

-   Щелкните правой кнопкой мыши на область конструктора и выберите **создать базу данных из модели...** , Entity Framework будет вычислять скрипт для повторного создания схемы на основе обновленной модели.
-   Нажмите кнопку **Готово**
-   Можно получать предупреждения о перезаписи существующего скрипта DDL и сопоставления и хранения части модели, щелкните **Да** для обоих этих предупреждений
-   Обновленный сценарий SQL, чтобы создать базу данных открывается при  
    *Созданный скрипт будет удалять все существующие таблицы и заново создать схему с нуля. Это может работать для локальной разработки, но не является приемлемым для принудительной отправки изменений в базе данных, который уже был развернут. Если вам нужно опубликовать изменения в уже развернутой базы данных, необходимо будет изменить сценарий или использовать средство сравнения схем для вычисления скрипт переноса.*
-   Щелкните правой кнопкой мыши сценарий, а затем выберите **Execute**, вам будет предложено указать базу данных для подключения, укажите LocalDB или SQL Server Express, в зависимости от версии Visual Studio вы используете

## <a name="summary"></a>Сводка

В этом пошаговом руководстве мы рассмотрели сначала модель разработки, которое позволяет создать модель в конструкторе EF, а затем создать базу данных из этой модели. Затем мы использовали модель для чтения и записи некоторых данных из базы данных. Наконец мы обновившего модель и создать повторно схему базы данных для соответствия модели.

---
title: Пространственные - конструктор EF - EF6
author: divega
ms.date: 10/23/2016
ms.assetid: 06baa6e1-d680-4a95-845b-81305c87a962
ms.openlocfilehash: 04ba6e8d4a59816ca31e831b8e466cb1152a3d1b
ms.sourcegitcommit: 2b787009fd5be5627f1189ee396e708cd130e07b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/13/2018
ms.locfileid: "45490219"
---
# <a name="spatial---ef-designer"></a>Пространственные - конструктор EF
> [!NOTE]
> **EF5 и более поздних версий только** -функции, интерфейсы API, и т.д., описанных на этой странице появились в Entity Framework 5. При использовании более ранней версии могут быть неприменимы некоторые или все сведения.

Видео и пошаговые руководства показано, как сопоставить пространственных типов с помощью Entity Framework Designer. Также показано, как использовать LINQ-запрос для поиска расстояние между двумя расположениями.

В этом пошаговом руководстве будет использоваться для создания новой базы данных Model First, но конструктор EF может также использоваться с [Database First](~/ef6/modeling/designer/workflows/database-first.md) рабочий процесс для сопоставления существующей базы данных.

В Entity Framework 5 появилась поддержка пространственных типов. Обратите внимание на то, что чтобы использовать новые функции, например пространственного типа, перечислимые типы и функции, возвращающие табличные значения, необходимо ориентироваться .NET Framework 4.5. Visual Studio 2012 предназначенного для .NET 4.5 по умолчанию.

Для использования пространственных типов данных необходимо также использовать с поставщиком Entity Framework с поддержкой пространственных. См. в разделе [поддержка пространственных типов](~/ef6/fundamentals/providers/spatial-support.md) Дополнительные сведения.

Существует два типа основных пространственных данных: geography и geometry. Тип данных сохраняет эллиптические данные (например, GPS координаты широты и долготы). Тип данных geometry представляет Евклидовой (плоской) системе координат.

## <a name="watch-the-video"></a>Просмотреть видео
В этом видео показано, как сопоставить пространственных типов с помощью Entity Framework Designer. Также показано, как использовать LINQ-запрос для поиска расстояние между двумя расположениями.

**Представленный**: Юлия Корнич

**Видео**: [WMV](http://download.microsoft.com/download/E/C/9/EC9E6547-8983-4C1F-A919-D33210E4B213/HDI-ITPro-MSDN-winvideo-spatialwithdesigner.wmv) | [MP4](http://download.microsoft.com/download/E/C/9/EC9E6547-8983-4C1F-A919-D33210E4B213/HDI-ITPro-MSDN-mp4video-spatialwithdesigner.m4v) | [WMV (ZIP)](http://download.microsoft.com/download/E/C/9/EC9E6547-8983-4C1F-A919-D33210E4B213/HDI-ITPro-MSDN-winvideo-spatialwithdesigner.zip)

## <a name="pre-requisites"></a>Предварительные требования

Необходимо будет установлен выпуск Visual Studio 2012 Ultimate, Premium, Professional и Web Express для выполнения этого пошагового руководства.

## <a name="set-up-the-project"></a>Настройка проекта

1.  Откройте Visual Studio 2012
2.  На **файл** последовательно выберите пункты **New**, а затем нажмите кнопку **проекта**
3.  В левой области щелкните **Visual C\#**, а затем выберите **консоли** шаблона
4.  Введите **SpatialEFDesigner** как имя проекта и нажмите кнопку **ОК**

## <a name="create-a-new-model-using-the-ef-designer"></a>Создание новой модели в конструкторе EF

1.  Щелкните правой кнопкой мыши имя проекта в обозревателе решений, выберите пункт **добавить**, а затем нажмите кнопку **новый элемент**
2.  Выберите **данных** меню слева, а затем выберите **ADO.NET Entity Data Model** в области шаблонов
3.  Введите **UniversityModel.edmx** имя файла, а затем нажмите кнопку **добавить**
4.  На странице мастера моделей EDM, выберите **пустую модель** в диалоговом окне Выбор содержимого модели
5.  Нажмите кнопку **Готово**

Конструктор сущностей, который предоставляет область конструктора для изменения модели, отображается.

Мастер выполняет следующие действия.

-   Создает файл EnumTestModel.edmx, который определяет концептуальную модель, модель хранения и сопоставления между ними. Задает свойство обработка артефактов метаданных из EDMX-файл для внедрения в выходной сборки, поэтому созданные метаданные файлы внедряются в сборку.
-   Добавляет ссылку на следующие сборки: EntityFramework, System.ComponentModel.DataAnnotations и System.Data.Entity.
-   Создает файлы UniversityModel.tt и UniversityModel.Context.tt и добавляет их в EDMX-файл. Эти файлы шаблонов T4 создания кода, который определяет тип производным DbContext и типов POCO, которые сопоставляются с сущностями в модели .edmx

## <a name="add-a-new-entity-type"></a>Добавить новый тип сущности

1.  Щелкните правой кнопкой мыши пустой участок области конструктора, выберите **Add -&gt; сущности**, появится диалоговое окно новой сущности
2.  Укажите **университета** для типа имя и указать **UniversityID** оставьте тот тип, что имя ключевого свойства **Int32**
3.  Нажмите кнопку **ОК**.
4.  Щелкните правой кнопкой мыши сущность и выберите **Add New -&gt; скалярное свойство**
5.  Переименовать новое свойство **имя**
6.  Добавить еще одно скалярное свойство и переименуйте его в **расположение** откройте окно свойств и измените тип нового свойства для **Geography**
7.  Сохранение модели и построение проекта
    > [!NOTE]
    > При создании, предупреждения о несопоставленных сущностях и ассоциациях, появляются в списке ошибок. Эти предупреждения можно игнорировать, поскольку после мы решили создать базу данных из модели, пропадут.

## <a name="generate-database-from-model"></a>Создание базы данных на основе модели

Теперь мы сможем создать базу данных, основанный на модели.

1.  Щелкните правой кнопкой мыши пустое место в области конструктора сущностей и выберите пункт **создать базу данных из модели**
2.  Диалогового окна соединения данных из мастера создания базы данных является выбор отображаемых щелкните **новое подключение** кнопку укажите **(localdb)\\mssqllocaldb** для имени сервера и  **Университет** базы данных и нажмите кнопку **ОК**
3.  Диалоговое окно с запросом, если вы хотите создать новую базу данных будет всплывающее окно, нажмите кнопку **Да**.
4.  Нажмите кнопку **Далее** и мастер создания базы данных приводит к возникновению ошибки языка описания данных (DDL) для создания базы данных, сформированный код DDL отображается сводка и параметры диалогового окна поле Обратите внимание, что, DDL не содержит определение для таблицу, которая сопоставляется с типом перечисления
5.  Нажмите кнопку **Готово** щелкнув Готово не выполняет скрипт DDL.
6.  Мастер создания базы данных выполняет следующие: открывает **UniversityModel.edmx.sql** в редакторе T-SQL формирует разделы схемы и сопоставления хранилища EDMX-файла файл строку подключения Adds в файл App.config
7.  Щелкните правой кнопкой мыши в редакторе T-SQL и выберите **Execute** The Server диалоговое окно подключения к откроется, введите сведения о соединении из шага 2 и нажмите кнопку **Connect**
8.  Чтобы просмотреть созданную схему, щелкните правой кнопкой мыши имя базы данных в обозревателе объектов SQL Server и выберите **обновления**

## <a name="persist-and-retrieve-data"></a>Сохранения и извлечения данных

Откройте файл Program.cs, в котором определен метод Main. Добавьте следующий код в функцию Main.

Код добавляет два новых университета объектов к контексту. Пространственные свойства инициализируются с помощью метода DbGeography.FromText. Географическая точка представить в виде WellKnownText передается в метод. Затем код сохраняет данные. Затем запрос LINQ, который возвращает объект университета, где она будет находиться в указанное расположение, ближайшее составлением и выполнением.

``` csharp
using (var context = new UniversityModelContainer())
{
    context.Universities.Add(new University()
    {
        Name = "Graphic Design Institute",
        Location = DbGeography.FromText("POINT(-122.336106 47.605049)"),
    });

    context.Universities.Add(new University()
    {
        Name = "School of Fine Art",
        Location = DbGeography.FromText("POINT(-122.335197 47.646711)"),
    });

    context.SaveChanges();

    var myLocation = DbGeography.FromText("POINT(-122.296623 47.640405)");

    var university = (from u in context.Universities
                                orderby u.Location.Distance(myLocation)
                                select u).FirstOrDefault();

    Console.WriteLine(
        "The closest University to you is: {0}.",
        university.Name);
}
```

Скомпилируйте и запустите приложение. Программа выдает следующие результаты.

```
The closest University to you is: School of Fine Art.
```

Чтобы просмотреть данные в базе данных, щелкните правой кнопкой мыши имя базы данных в обозревателе объектов SQL Server и выберите **обновить**. Щелкните правой кнопкой мыши таблицу и выберите **данные представления**.

## <a name="summary"></a>Сводка

В этом пошаговом руководстве мы рассмотрели способ сопоставления пространственных типов, с помощью Entity Framework Designer и использовании пространственных типов в коде. 

---
title: Наследование TPH конструктора — EF6
author: divega
ms.date: 2016-10-23
ms.prod: entity-framework
ms.author: divega
ms.manager: avickers
ms.technology: entity-framework-6
ms.topic: article
ms.assetid: 72d26a8e-20ab-4500-bd13-394a08e73394
caps.latest.revision: 3
ms.openlocfilehash: 0a017d3b97808cede3134119940b2e5839d0f282
ms.sourcegitcommit: f05e7b62584cf228f17390bb086a61d505712e1b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/08/2018
ms.locfileid: "39122286"
---
# <a name="designer-tph-inheritance"></a>Конструктора МОДЕЛИ наследования
Это пошаговое руководство показывает, как реализовать наследование таблица на иерархию (TPH) в концептуальной модели с помощью Entity Framework Designer (конструктор EF). Наследование TPH использует одну таблицу базы данных для сопровождения данных всех типов сущностей в иерархии наследования.

В этом пошаговом руководстве мы сопоставит таблицы Person с тремя типами сущностей: человек (базовый тип), Student (является производным от пользователя) и Instructor (наследуется от Person). Мы создадим концептуальной модели из базы данных (Database First) и затем изменить модель для реализации МОДЕЛИ наследования, в конструкторе EF.

Можно сопоставить МОДЕЛИ наследования, с помощью Model First, но вам пришлось бы писать собственные рабочего процесса создания базы данных, который является сложным. Можно затем назначить этот рабочий процесс для **рабочего процесса создания базы данных** свойства в конструкторе EF. Простой альтернативой является использование Code First.

## <a name="other-inheritance-options"></a>Другие параметры наследования

Одна таблица на тип (TPT) – еще один тип наследования, в котором отдельные таблицы в базе данных, сопоставляются сущности, участвующие в наследовании.  Сведения о сопоставлении таблица на тип наследования в конструкторе EF, см. в разделе [наследование TPT конструктор EF](~/ef6/modeling/designer/inheritance/tpt.md).

Таблица на конкретный тип наследования (TPC) и модели смешанного наследования поддерживаются средой выполнения Entity Framework, но не поддерживаются в конструкторе EF. Если вы хотите использовать TPC или смешанных наследования, можно двумя способами: использовать Code First, или вручную изменить EDMX-файла. Если вы предпочтете работать с файлом EDMX, окно сведений о сопоставлении будет помещен в «безопасный режим», и вы не сможете использовать конструктор для изменения сопоставлений.

## <a name="prerequisites"></a>Предварительные требования

Для выполнения данного пошагового руководства требуется:

- Последнюю версию Visual Studio.
- [Образца базы данных School](~/ef6/resources/school-database.md).

## <a name="set-up-the-project"></a>Настройка проекта

-   Откройте Visual Studio 2012.
-   Выберите **файл -&gt; Новинка —&gt; проекта**
-   В левой области щелкните **Visual C\#**, а затем выберите **консоли** шаблона.
-   Введите **TPHDBFirstSample** как имя.
-   Нажмите кнопку **ОК**.

## <a name="create-a-model"></a>Создание модели

-   Щелкните правой кнопкой мыши имя проекта в обозревателе решений и выберите **Add -&gt; новый элемент**.
-   Выберите **данных** меню слева, а затем выберите **ADO.NET Entity Data Model** в области шаблонов.
-   Введите **TPHModel.edmx** имя файла, а затем нажмите кнопку **добавить**.
-   В диалоговом окне Выбор содержимого модели выберите **создать из базы данных**, а затем нажмите кнопку **Далее**.
-   Нажмите кнопку **новое подключение**.
    В диалоговом окне Свойства соединения, введите имя сервера (например, **(localdb)\\mssqllocaldb**) выберите метод проверки подлинности, тип **School** для имени базы данных, а затем Нажмите кнопку **ОК**.
    В диалоговом окне Выбор подключения к базе данных обновляется параметр подключения базы данных.
-   В диалоговом окне Выбор объектов базы данных в узле таблицы выберите **Person** таблицы.
-   Нажмите кнопку **Готово**.

Конструктор сущностей, который предоставляет область конструктора для изменения модели, отображается. Все объекты, которые выбраны в диалоговом окне Выбор объектов базы данных добавляются в модель.

То есть как **Person** таблица выглядит в базе данных.

![PersonTable](~/ef6/media/persontable.png) 

## <a name="implement-table-per-hierarchy-inheritance"></a>Реализация наследования таблица на иерархию

**Person** таблица имеет **дискриминатора** столбец, который может иметь одно из двух значений: «Student» и «Instructor». В зависимости от значения **Person** таблицы будут сопоставлены с **учащихся** сущности или **преподавателя** сущности. **Person** таблица также содержит два столбца, **HireDate** и **EnrollmentDate**, который должен быть **допускает значения NULL** так, как пользователь не может быть Student и instructor, в то же время (по крайней мере не в этом пошаговом руководстве).

### <a name="add-new-entities"></a>Добавление новых сущностей

-   Добавьте новую сущность.
    Чтобы сделать это, щелкните правой кнопкой мыши на пустую часть области конструктора в конструкторе Entity Framework и выберите **Add -&gt;сущности**.
-   Тип **преподавателя** для **имя сущности** и выберите **Person** из раскрывающегося списка для **базовый тип**.
-   Нажмите кнопку **ОК**.
-   Добавьте другой новой сущности. Тип **учащихся** для **имя сущности** и выберите **Person** из раскрывающегося списка для **базовый тип**.

Были добавлены два новых типа сущности в область конструктора. Стрелка идет от новых типов сущности к **Person** типа сущности; это означает, что **Person** является базовым типом для новых типов сущности.

-   Щелкните правой кнопкой мыши **HireDate** свойство **Person** сущности. Выберите **Вырезать** (или с помощью клавиши Ctrl + X).
-   Щелкните правой кнопкой мыши **преподавателя** сущности и выберите **вставить** (или с помощью клавиши Ctrl + V).
-   Щелкните правой кнопкой мыши **HireDate** свойство и выберите **свойства**.
-   В **свойства** окне **Nullable** свойства **false**.
-   Щелкните правой кнопкой мыши **EnrollmentDate** свойство **Person** сущности. Выберите **Вырезать** (или с помощью клавиши Ctrl + X).
-   Щелкните правой кнопкой мыши **учащихся** сущности и выберите **вставки (или раздела используйте Ctrl + V).**
-   Выберите **EnrollmentDate** и установите **Nullable** свойства **false**.
-   Выберите **Person** типа сущности. В **свойства** окна, задайте его **абстрактный** свойства **true**.
-   Удалить **дискриминатора** свойства из **Person**. В следующем разделе объясняется причина, по которой ее следует удалить.

### <a name="map-the-entities"></a>Сопоставьте сущности

-   Щелкните правой кнопкой мыши **преподавателя** и выберите **сопоставление таблицы.**
    Сущности Instructor выбран в окне «сведения о сопоставлении».
-   Нажмите кнопку **&lt;добавить таблицу или представление&gt;** в **сведения о сопоставлении** окна.
    **&lt;Добавить таблицу или представление&gt;** поле становится стрелку раскрывающегося списка таблиц и представлений, с которой могут быть сопоставлены выбранной сущности.
-   Выберите **Person** из раскрывающегося списка.
-   **Сведения о сопоставлении** окно обновляется с помощью сопоставления столбцов по умолчанию и параметр для добавления условия.
-   Щелкните  **&lt;добавить условие&gt;**.
    **&lt;Добавить условие&gt;** поле становится стрелку раскрывающегося списка столбцов, для которых можно задать условия.
-   Выберите **дискриминатора** из раскрывающегося списка.
-   В **оператор** столбец **сведения о сопоставлении** выберите = из раскрывающегося списка.
-   В **значение/свойство** столбец, тип **преподавателя**. Конечный результат должен выглядеть следующим образом:

    ![MappingDetails2](~/ef6/media/mappingdetails2.png)

-   Повторите эти шаги для **учащихся** тип сущности, но создать условие равно **учащихся** значение.  
    *Причина, мы хотели бы удалить **дискриминатора** свойство, является, поскольку невозможно сопоставить столбец таблицы более одного раза. Этот столбец будет использоваться для условного сопоставления, поэтому его нельзя использовать для сопоставления свойства, а также. Единственным способом, он может использоваться в обоих случаях если условие использует **Is Null** или **Is Not Null** сравнения.*

Теперь наследование типа «одна таблица на иерархию» успешно реализовано.

![FinalTPH](~/ef6/media/finaltph.png)

## <a name="use-the-model"></a>Использование модели

Откройте **Program.cs** файл, в котором **Main** определен метод. Вставьте следующий код в **Main** функции. Код выполняет три запроса. Первый запрос возвращает все **Person** объектов. Второй запрос использует **OfType** метод для возврата **преподавателя** объектов. Третий запрос использует **OfType** метод для возврата **учащихся** объектов.

``` csharp
    using (var context = new SchoolEntities())
    {
        Console.WriteLine("All people:");
        foreach (var person in context.People)
        {
            Console.WriteLine("    {0} {1}", person.FirstName, person.LastName);
        }

        Console.WriteLine("Instructors only: ");
        foreach (var person in context.People.OfType<Instructor>())
        {
            Console.WriteLine("    {0} {1}", person.FirstName, person.LastName);
        }

        Console.WriteLine("Students only: ");
        foreach (var person in context.People.OfType<Student>())
        {
            Console.WriteLine("    {0} {1}", person.FirstName, person.LastName);
        }
    }
```
